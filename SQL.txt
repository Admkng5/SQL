--Задание №1

--1
--Вывести названия сабрегионов которые в названии содержат «ca»
SELECT * FROM SH.COUNTRIES
    WHERE UPPER(COUNTRY_SUBREGION) LIKE '%CA%'

--2
--Вывести страны региона Европы и Азии, а также сабрегиона северной америки,  у которых ID страны больше или равен 52782
SELECT * FROM SH.COUNTRIES
    WHERE (UPPER(COUNTRY_REGION) LIKE 'EUROPE' OR UPPER(COUNTRY_REGION) LIKE 'ASIA' OR UPPER(COUNTRY_SUBREGION) LIKE 'NORTHERN AMERICA')
    AND COUNTRY_ID >= 52782

--3
--Вывести ID страны и  «E» для региона «Europe», «MID» для региона «Middle East», название региона для остальных регионов. Результат должен быть отсортирован по ID страны, в него должны попасть только страны начинающиеся с буквы «S» и не находящиеся в регионе «Oceania»
SELECT
        CASE
            WHEN UPPER(COUNTRY_REGION) = 'EUROPE' THEN 'E'
            WHEN UPPER(COUNTRY_REGION) = 'MIDDLE EAST' THEN 'MID'
            ELSE COUNTRY_REGION
        END, COUNTRY_ID
    FROM SH.COUNTRIES
    WHERE UPPER(COUNTRY_NAME) LIKE 'S%' AND UPPER(COUNTRY_REGION) <> 'OCEANIA'
    ORDER BY COUNTRY_ID
    
--Задание №2

--1
--Из таблицы co.CUSTOMERS вывести первые буквы имён. Напротив каждой буквы, вывести количество почтовых ящиков, имена владельцев которых начинаются с той же буквы.
--Вывести только если данное количество больше одного. Использовать having без with.
SELECT SUBSTR(FULL_NAME, 1, 1) AS SUBSTR, COUNT(SUBSTR(FULL_NAME, 1, 1)) AS CNT FROM co.CUSTOMERS
    GROUP BY SUBSTR(FULL_NAME, 1, 1)
    HAVING COUNT(SUBSTR(FULL_NAME, 1, 1)) > 1
    
SELECT SUBSTR(FULL_NAME, 1, 1) AS SUBSTR, 
(SELECT COUNT(*) AS CNT FROM co.CUSTOMERS WHERE SUBSTR = SUBSTR(FULL_NAME, 1, 1))
FROM co.CUSTOMERS
    GROUP BY SUBSTR(FULL_NAME, 1, 1)
    HAVING COUNT(SUBSTR(FULL_NAME, 1, 1)) > 1

    
--2
--Решить задание 1, ипользуя только with без having.
WITH newTable AS(
SELECT SUBSTR(FULL_NAME, 1, 1) AS SUBSTR, COUNT(SUBSTR(FULL_NAME, 1, 1)) AS CNT FROM co.CUSTOMERS
    GROUP BY SUBSTR(FULL_NAME, 1, 1)
        ORDER BY  SUBSTR(FULL_NAME, 1, 1)
    )
    
SELECT * FROM newTable
    WHERE CNT > 1

--Задание №3

--1

--Вывести названия работ, на которых хотя бы один сотрудник получает ровно 6000
SELECT DISTINCT JOB_TITLE FROM ad.AD_JOBS

    JOIN ad.AD_FACULTY_DETAILS ON ad.AD_JOBS.JOB_ID = ad.AD_FACULTY_DETAILS.JOB_ID

        WHERE ad.AD_FACULTY_DETAILS.SALARY = 6000
       
        



--2

--Все сотрудники скинулись после зарплаты скинулись по 2000$ на новые шторы. 
--Вывести список должностей, среди которых есть хотя бы один сотрудник, 
--у которого денег с зарплаты осталось меньше, чем разница между максимальной и минимальной ставкой для его должности.
SELECT DISTINCT * FROM ad.AD_JOBS

    JOIN ad.AD_FACULTY_DETAILS ON ad.AD_JOBS.JOB_ID = ad.AD_FACULTY_DETAILS.JOB_ID

        WHERE SALARY - 2000 < MAX_SALARY - MIN_SALARY
